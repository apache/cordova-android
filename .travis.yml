language: android
sudo: false
jdk:
  - oraclejdk8
env:
  global:
    - ANDROID_TEST=$(which `which android`)
android:
  components:
    # the two entries for 'tools' here are important: this is a weird dance we need
    # to do to upgrade to v25 or newer of the tools.
    - tools
    - platform-tools
    # DONT DELETE THE NEXT LINE! see above comment
    - tools
    # The BuildTools version used by your project. Here we just specify the absolute latest at all times.
    - build-tools
    # The Android SDK version or API levels we will be testing against. We should be doing this against recent versions.
    - android-26
    - android-25
    # Extras
    - extra-google-m2repository
    - extra-android-m2repository
    # TODO: Emulators
before_install:
  # environment setup
  - nvm install 6
  # ensure at least gradle 3.3 is in place.
  - wget http://services.gradle.org/distributions/gradle-3.3-bin.zip
  - unzip gradle-3.3-bin.zip
  - export GRADLE_HOME=$PWD/gradle-3.3
  - export PATH=$GRADLE_HOME/bin:$PATH
  - gradle --version
  - node --version
  - echo $ANDROID_HOME
  - echo $(which `which android`)
  - echo $ANDROID_TEST
install:
  # cordova-android-specific and emulator setup
  - pushd test && gradle :wrapper -b build.gradle && popd
  - npm install
  - npm install -g codecov
  #- echo no | android create avd --force -n test -t android-25 --abi armeabi-v7a
  #- emulator -avd test -no-audio -no-window &
  #- android-wait-for-emulator
  #- adb shell input keyevent 82 &
script:
  # test commands
  - pushd test && ./gradlew test && popd
  - npm test
  - npm run cover
after_script:
  - codecov
